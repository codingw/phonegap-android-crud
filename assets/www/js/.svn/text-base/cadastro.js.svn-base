$(document).ready(function() {
	$("#cpf").mask("999.999.999-99");
	$("#data").mask("99/99/9999");
});


function salvarOuAtualizarRegistro() {
	if ($('#nome').val().trim() == '') {
		alert('Preencha o campo Nome!');
	} else {
		var db = window.openDatabase("dtp-formulario", "1.0", "dtp-formulario", 2000000);
	    db.transaction(function insert(tx) {
	    	var id = sessionStorage.getItem("id");
	    	if (id == null) {
	    		var sql = "INSERT INTO beneficiarios(nome, cpf, uf, data_nascimento) values(?,?,?,?)";
	        	tx.executeSql(sql, [$('#nome').val(), $('#cpf').val(), $('#uf').val(), $('#data').val()]);
	        	alert('Registro salvo com sucesso!');
	    	} else {
	    		var sql = "UPDATE beneficiarios SET nome = ?, cpf = ?, uf = ?, data_nascimento = ? WHERE id = ?";
	        	tx.executeSql(sql, [$('#nome').val(), $('#cpf').val(), $('#uf').val(), $('#data').val(), id]);
	        	alert('Registro atualizado com sucesso!');
	    	}
	    }, tratarErro);
	    window.location = "listagem.html";
	}
}

function verificarSeEstaEditandoRegistro() {
	var id = sessionStorage.getItem("id");
	if (id != null) {
		carregarRegistro(id);
	}
}

function carregarRegistro(id) {
	var db = window.openDatabase("dtp-formulario", "1.0", "dtp-formulario", 2000000);
	
    db.transaction(function select(tx) {
    	var sql = "SELECT * FROM beneficiarios WHERE id = ?";
    	tx.executeSql(sql, [id], preencherCampos);
    }, tratarErro);
}

function preencherCampos(tx, results) {
	var registro = results.rows.item(0);
	$('#nome').val(registro.nome);
    $('#cpf').val(registro.cpf);
    $('#uf').val(registro.uf);
    $('#uf').selectmenu('refresh', true);
    $('#data').val(registro.data_nascimento);
}

function tratarErro(tx, error) {
    alert("Database Error: " + error);
}
